<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>提交订单信息</title>
    <link href="css/style.css" type="text/css" rel="stylesheet" />
    <script src="js/jquery-1.7.min.js" type="text/javascript"></script>
    <script src="js/common.js"  type="text/javascript"></script>

</head>
<body class="index">
<div class="top_ad"><div class="w1200"><a href="#" id="close"></a></div></div>

<div class="top">
    <div class="w1200">
        <div class="left">您好，欢迎光临易易城！<a href="#">[登录]</a> <a href="#">[注册]</a></div>
        <div class="right"><a href="#">我的会员中心</a>|<a href="#">收藏夹</a>|<a href="#">服务中心</a>|<a href="#">在线客服</a>|<a href="#">购物车<b>0</b>件</a></div>
        <div class="clear"></div>
    </div>
</div>

<div class="head">
    <div class="w1200">
        <div class="logo"><a href="#"></a></div>
        <div class="search">
            <form action="#" class="form">
                <input type="text" value="输入商品关键字" name="keyword" class="txt" onfocus="if(value=='输入商品关键字') {value=''}" onblur="if(value=='') {value='输入商品关键字'}"/>
                <input type="submit" value="搜索" class="sub"/>
            </form>
            <p><a href="#">iphone6s</a>|<a href="#">面膜</a>|<a href="#">婚庆床品</a>|<a href="#">运动鞋</a>|<a href="#">眼霜</a>|<a href="#">月饼</a>|<a href="#">智能手机</a>|<a href="#">连衣裙</a></p>
        </div>
        <div class="s_r">
            <dl>
                <dt><p>购物车<span>0</span></p></dt>
                <dd>客服电话：<b>400-0139-038</b></dd>
            </dl>
        </div>
        <div class="clear"></div>
    </div>
</div>

<div class="menu">
    <div class="w1200">
        <div class="item" id="nav"><a href="#" class="nav">全部商品分类</a>
            <div class="nav_son">
                <ul>
                    <li class="li01"><a href="#">功能产品</a></li>
                    <li class="li02"><a href="#">服装箱包</a></li>
                    <li class="li03"><a href="#">美妆护肤</a></li>
                    <li class="li04"><a href="#">珠宝饰品</a></li>
                    <li class="li05"><a href="#">数码家电</a></li>
                    <li class="li06"><a href="#">食品茶酒</a></li>
                    <li class="li07"><a href="#">运动体育</a></li>
                    <li class="li08"><a href="#">家居家纺</a></li>
                    <li class="li09"><a href="#">生活服务</a></li>
                    <li class="li10"><a href="#">其他</a></li>
                </ul>
            </div>
        </div>
        <div class="item"><a href="index.html" class="home">商城首页</a></div>
        <div class="item"><a href="#">易易特色</a></div>
        <div class="item"><a href="#">热销产品</a></div>
        <div class="item"><a href="#">新品上市</a></div>
        <div class="item"><a href="#">精品推荐</a></div>
        <div class="item"><a href="#">生活服务</a></div>
    </div>
</div>


<div class="w1200">
    <div class="position"><a href="#">首页</a> > <a href="#">购物车</a></div>

    <div class="shopcar">
        <div class="info_lc"><span class="sp01">我的购物车</span><span class="sp02">填写提交信息表单</span><span class="sp03">在线支付</span></div>

        <dl class="info">
            <dt><span>确认收货地址</span></dt>
            <dd>
                <div class="item"><span><font>*</font>所在地区：</span>
                    <select name="province" id="province">
                        <option value="广东省">广东省</option></select>
                    <select name="city" id="city">
                        <option value="">请选择城市</option>
                    </select>
                    <select name="county" id="county">
                        <option >请选择地区</option>
                    </select>
                    <!-- <input type="tex" class="txt" /></div>-->
                    <!--<div class="item"><span><font>*</font>邮政编码：</span><input type="tex" class="txt"/></div>-->

                    <div class="item">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td >详细地址</td>
                                <td ><textarea id="addressdetail" ></textarea></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td >地址</td>
                                <td >删除</td>
                            </tr>
                            <tbody id="addressList">

                            </tbody>
                        </table>
                    </div>
                    <!--<div class="item"><span><font>*</font>电话：</span><input type="tex" class="txt"/></div>-->
                    <div class="item"><input type="button" id="saveAddressbtn" class="sub"  value="保存收货人信息"/></div>
            </dd>
        </dl>

        <dl>
            <dt><span>确认订单信息</span></dt>
            <dd>
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr class="tr_t">
                        <td width="2%">&nbsp;</td>
                        <td width="48%">商品</td>
                        <td width="25%">单价</td>
                        <td width="13%">数量</td>
                        <td width="12%">小计</td>
                    </tr>
                    <tbody id="CheckCartList"></tbody>
                    <tr class="tr_c">
                        <td>&nbsp;</td>
                        <td>
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <!--<tr>
                                  <td width="15%"><img src="images/ico23.jpg"/></td>
                                  <td width="85%"><a href="#" class="title">头层牛皮真皮沙发 客厅家具 FPSF0814 进口中厚皮 双人位+单人位+贵妃位</a></td>
                                </tr>
                              </table>
                          </td>
                          <td class="price">￥3083.00</td>
                          <td>1</td>
                          <td class="price">￥3083.00</td>
                        </tr>
                        <tr class="tr_d">
                          <td colspan="7">
                              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                               <tr>
                                     <td width="3%">&nbsp;</td>
                                  <td width="6%">买家留言：</td>
                                  <td width="75%"><input type="text" value="" class="msg"/></td>
                                  <td width="6%">应付金额：</td>
                                  <td width="10%" class="all_price"><font>￥3083.00</font></td>
                                </tr>-->
                            </table>
                        </td>
                    </tr>
                </table>
                <div class="clear"></div>

            </dd>
        </dl>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="go_tb">
            <tr>
                <td width="20%"><a href="#" class="go_buy">继续购物</a></td>
                <td width="63%">&nbsp;</td>
                <td width="17%" align="right"><a href="#" class="code">结算</a></td>
            </tr>
        </table>
        <div class="clear"></div>
    </div>
</div>

<!--footer-->
<div class="footer">
    <div class="f_bz">
        <div class="w1200">
            <dl class="dl01">
                <dt>正品保证</dt>
                <dd>正品护航  购物无忧</dd>
            </dl>
            <dl class="dl02">
                <dt>你消费 我买单</dt>
                <dd>返现购物商城</dd>
            </dl>
            <dl class="dl03">
                <dt>品类丰富</dt>
                <dd>品类齐全 轻松购物</dd>
            </dl>
            <dl class="dl04">
                <dt>特色服务体验</dt>
                <dd>为您呈现不一样的服务</dd>
            </dl>
            <div class="clear"></div>
        </div>
    </div>
    <div class="f_nav">
        <div class="w1200">
            <dl>
                <dt>新手指南</dt>
                <dd>
                    <a href="#">注册新用户</a>
                    <a href="#">商品订购流程</a>
                    <a href="#">会员注册协议</a>
                </dd>
            </dl>
            <dl>
                <dt>付款方式</dt>
                <dd>
                    <a href="#">支付宝支付</a>
                    <a href="#">网上银行支付</a>
                    <a href="#">货到付款</a>
                </dd>
            </dl>
            <dl>
                <dt>常见问题</dt>
                <dd>
                    <a href="#">订单状态</a>
                    <a href="#">发票说明</a>
                </dd>
            </dl>
            <dl>
                <dt>售后服务</dt>
                <dd>
                    <a href="#">退换货政策</a>
                    <a href="#">退换货流程</a>
                    <a href="#">退款说明</a>
                    <a href="#">退换货申请</a>
                </dd>
            </dl>
            <dl>
                <dt>客服中心</dt>
                <dd>
                    <a href="#">常见问题</a>
                    <a href="#">联系客服</a>
                    <a href="#">投诉与建议</a>
                </dd>
            </dl>
            <div class="ewm"><img src="images/home/ico35.png"/></div>
            <div class="ewm"><img src="images/home/ico38.png"/></div>
            <div class="clear"></div>
        </div>
    </div>
    <div class="w1200">
        <div class="bottom">
            <a href="#">关于我们</a>|<a href="#">帮助中心</a>|<a href="#">法律声明</a>|<a href="#">用户协议</a>|<a href="#">联系我们</a>|<a href="#">人才招聘</a>|<a href="#">站点地图</a>

            <p>网络文化经营许可证：粤网文[2015]0295-065号<br />© 2015 深圳易易城科技网络有限公司. 粤ICP备15042543号</p>
            <p class="p02"><img src="images/home/ico25.jpg"/><img src="images/home/ico26.jpg"/><img src="images/home/ico27.jpg"/><img src="images/home/ico36.jpg"/><img src="images/home/ico37.jpg"/></p>
        </div>
    </div>
</div>
<!--float_right-->
<div class="float">
    <ul>
        <li><a href="#" class="a01"></a></li>
        <li><a href="#" class="a02"></a></li>
        <li><a href="#" class="a03"></a></li>
        <li><a href="#" class="a04"></a></li>
    </ul>
</div>

</body>
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/address.js"></script>
<script>

    var cartIds=sessionStorage.getItem("cartIds")||"";
    getByCartIds();
    //获取购物车选中的商品信息
    function getByCartIds() {
        $.ajax({
            url:"../cart/getorderscart.action",
            type:"GET",
            data:{
                ids:cartIds
            },
            success:function (result) {
                if (result.code=="0")
                {
                    cartList=result.data;
                    handleCheckCartList(result.data);
                }
            },
            error:function (error) {
                alert(error)
            }
        })
    }
    //将商品信息展示到页面
    function   handleCheckCartList(list) {
        var row=' <tr class="tr_c">\n' +
            '<td>&nbsp;</td>\n' +
            '<td>\n' +
            '<table width="100%" border="0" cellspacing="0" cellpadding="0">\n' +
            '<tr>\n' +
            '<td width="15%"><img src="&&productimg"/></td>\n' +
            '<td width="85%"><a href="#" class="title"> &&name  </a></td>\n' +
            '</tr>\n' +
            '</table>\n' +
            '</td>\n' +
            '<td class="price">&&price</td>\n' +
            '<td>&&count</td>\n' +
            '<td class="price">&&allprice</td>\n' +
            '</tr>'

        var totalPrice=0 ;
        var allhtml="";
        for (var i = 0; i <list.length ; i++) {
            var cart=list[i];
            var product=cart.product;

            var row_=row.replace("&&productimg",product.productimg);
            row_=row_.replace("&&name",product.productname);
            row_=row_.replace("&&price",product.price);
            row_=row_.replace("&&count",cart.productnum);
            row_=row_.replace("&&allprice",product.price*cart.productnum*1.0);

            totalPrice+=product.price*cart.productnum*1.0;
            allhtml+=row_;
        }
        $("#CheckCartList").html(allhtml);
        $("#all_price").text(totalPrice);
    }
    //点击保存地址 省市区 详细信息
    $("#saveAddressbtn").click(function () {
        var province = $("#province").val();
        var city=$("#city").val();
        var county=$("#county").val();
        var addressdetail = $("#addressdetail").val();
        saveAddress(province,city,county,addressdetail);
    });
    //保存地址
    function  saveAddress(province,city,county,addressdetail) {
        $.ajax({
            url:"../updateaddress.action",
            data:{
                province:province,
                city: city,
                county:county,
                addressdetail:addressdetail
            },
            type:"POST",
            success:function (result) {
                if (result.code == "0") {
                    alert(result.msg);

                    getAddressList();
                }
                else {
                    alert(result.msg);
                }
            },
            error:function (error) {
                alert(error);
            }
        })
    }
    //获取用户地址
    getAddressList();
    function getAddressList() {
        $.ajax({
            url:"../getaddress.action",
            type:"POST",
            success:function (result) {
                if (result.code=="0")
                {
                    cartList=result.data;
                    handleAddressList(result.data);
                }
            },
            error:function (error) {
                alert(error)
            }
        })
    }
    //将获取到的地址展示在到页面上
    function   handleAddressList(list) {
        var row=' <tr class="tr_c">\n' +
            '<td> <input    type="radio"  name="addressId" checked="radio" class="addressId" value="&&addressId" /></td>\n' +
            '<td style="width: 200px"> &&province&&city&&county&&addressdetail</td>\n' +
            '<td style="width: 200px"><a href="#" class="deleteOne">删除 </a></td>\n' +
            '</tr>';


        var allhtml="";
        for (var i = 0; i <list.length ; i++) {
            var Address=list[i];
            var row_=row.replace("&&addressId",Address.addressid);
            row_=row_.replace("&&province",Address.province);
            row_=row_.replace("&&city",Address.city);
            row_=row_.replace("&&county",Address.county);
            row_=row_.replace("&&addressdetail",Address.addressdetail);
            allhtml+=row_;
        }
        $("#addressList").html(allhtml);
    }
    //删除一个地址   获取地址ID
    $("#addressList").on("click",".deleteOne",function () {
        var addressId=$(this).parent().parent().children().eq(0).children(":input.addressId").val();
        deleteAddress(addressId);
    });
    //删除一个地址  ajax
    function deleteAddress(addressId) {
        $.ajax({
            url:"../deleteaddress.action",
            data:{
                addressid:addressId
            },
            traditional: true,  //解决传递数组的问题
            success:function (result) {
                if (result.code=="0")
                {
                    console.log("全部移除成功");
                    getAddressList();

                }
                else {
                    console.log("移除出错")
                }
            },
            error:function (error) {
                console.log(error)
            }
        })
    }
    //点击结算按钮  提交订单
    $(".code").click(function () {

        var id=$("input[name='addressId']:checked").val();
        submitOrder(id);
    });

    //提交订单的 ajax
    function submitOrder(id) {
        $.ajax({
            url:"../order/orderaction.action",
            data:{
                shoppingcartid:cartIds,
                addressid:id
            },
            type:"POST",
            success:function (result) {
                if (result.code == "0") {
                    alert(result.msg);
                    location.href="payply.html";
                }
                else {
                    alert(result.msg);
                }
            },
            error:function (error) {
                alert(error);
            }
        })
    }
    //sessionStorage.setItem("orderid",id);
</script>
</html>
















